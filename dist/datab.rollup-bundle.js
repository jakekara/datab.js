var datab=function(t){"use strict";var o=function(o){if(void 0===o)var o=[[]];this.__rows=o,this.__cols=t.transpose(o);var e=function(o){return t.range(o.length).map(function(t){return String(t)})};return this.__index={row:e(this.__rows),col:e(this.__cols)},this.rows=function(){return this.__rows},this.cols=function(){return this.__cols},this};o.prototype.copy=function(){return new o(this.rows()).index("row",this.index("row")).index("col",this.index("col"))},o.prototype.transpose=function(){return new o(this.cols()).index("row",this.index("col")).index("col",this.index("row"))},o.prototype.index=function(t,o){if(void 0===t)return this.__index;if(void 0===o)return this.__index[t];if(this.__index[t].length!=o.length)throw"data.index: array must be same length as axis ";return this.__index[t]=o,this},o.prototype.drop_row=function(t){var t=String(t),e=this.index("row").indexOf(t);if(e<0)throw"data.drop_row: id not found";return new o(this.rows().splice(e)).index("row",this.index("row").splice(e)).index("col",this.index("col"))},o.prototype.drop_col=function(t){return this.transpose().drop_row(t).transpose()},o.prototype.add_row=function(t,e,n){if(void 0===n)var n=this.cols().length;if(void 0===e)var e=String(e);if(void 0===t)throw"data.add_row: requires an array of values";if(t.length!=this.cols().length)throw"data.add_row: invalid array length";var r=this.rows(),i=this.index("row");return r.splice(n,0,t),i.splice(n,0,e),new o(r).index("row",i).index("col",this.index("col"))},o.prototype.add_col=function(t,o,e){return this.transpose().add_row(t,o,e).transpose()},o.prototype.to_obj=function(){var t=[],o=this.index("col");return this.rows().forEach(function(e,n){var r={};e.forEach(function(t,e){r[o[e]]=t}),t.push(r)}),t},o.prototype.to_csvblob=function(){return new Blob([this.to_csv()],{type:"text/csv;charset=utf-8;"})},o.prototype.to_jsonblob=function(){return new Blob([this.to_json()],{type:"application/json;charset=utf-8;"})},o.prototype.to_csv=function(o,e){return t.csvFormat(this.add_col(this.index("row"),"",0).to_obj())},o.prototype.to_json=function(){return JSON.stringify(this.to_obj())},o.prototype.from_obj=function(t){if(t.length<1)return[[]];var e=Object.keys(t[0]),n=[];for(var r in t){var i=t[r],s=[],a=0;for(var d in e)void 0===i[e[d]]&&a++,s.push(i[e[d]]);a!=s.length&&n.push(s)}var c=new o(n);return c.index("col",e),c},o.prototype.from_input=function(e,n){e.on("change",function(){var r=new FileReader,i=e.node().files;if(void 0===i||i.length<1)return void console.error("no file selected");var s=i[0];r.onloadend=function(e){n(new o([[]]).from_obj(t.csvParse(r.result)))},r.readAsText(s)})};var e=function(){return this.__drop_mode=!1,this.__edit_mode=!1,this};return e.prototype.obj=function(t){if(void 0===t)return this.__obj;if(!(t instanceof o))throw"data.ui.obj requires a datab.data object as only argument";return this.__obj=t,this},e.prototype.container=function(t){return void 0===t?this.__container:(this.__container=t,this)},e.prototype.draw=function(){var t=this.__container;t.html("");var o=t.append("table"),e=o.append("thead").append("tr"),n=o.append("tbody");e.append("td").text("");var r=(e.selectAll("th").data(this.obj().index("col")).enter().append("th").attr("data-col",function(t,o){return o}).attr("data-col-head",function(t,o){return o}).text(function(t){return t}),n.selectAll("tr").data(this.obj().rows()).enter().append("tr").attr("data-row",function(t,o){return o})),i=this.obj().index("row");r.append("th").attr("data-row-head",function(t,o){return o}).text(function(t,o){return i[o]});r.selectAll("td").data(function(t,o){return t}).enter().append("td").attr("data-col",function(t,o){return o}).text(function(t){return t});return this.drop_mode(this.drop_mode()),this.edit_mode(this.edit_mode()),this},e.prototype.from_html=function(){var e=this.__container,n=(e.select("thead"),[]),r=[],i=[];try{e.select("thead").selectAll("th").each(function(){n.push(t.select(this).text())})}catch(t){throw"Error importing column headings. note: <table> must contain <thead><th>... structure error: "+t}try{e.select("tbody").selectAll("th").each(function(o,e){r.push(t.select(this).text())})}catch(t){throw"Error importing row headings. note: <table> must contain <tbody><tr><th>... structure error: "+t}try{e.select("tbody").selectAll("tr").each(function(){var o=[];t.select(this).selectAll("td").each(function(t){o.push(t)}),i.push(o)})}catch(t){throw"Error importing rows and cells headings. note: <table> must contain <tbody><tr><td>... structure error: "+t}this.obj(new o(i).index("row",r).index("col",n))},e.prototype.handle_clicks=function(t){this.container().selectAll("th").on("click",t)},e.prototype.edit_mode=function(o){if(void 0===o)return this.__edit_mode;if("boolean"!=typeof o)throw"datab.ui.drop_mode optional arg must be boolean or undefined";if(this.__edit_mode=o,0==this.__edit_mode)return this;var e=this;return this.handle_clicks(function(){console.log("handling",this),e.container().selectAll("th").attr("contenteditable",null),t.select(this).attr("contenteditable",!0),t.select(this).on("blur",function(){e.from_html(),e.draw()})}),this},e.prototype.drop_mode=function(o){if(void 0===o)return this.__drop_mode;if("boolean"!=typeof o)throw"datab.ui.drop_mode optional arg must be boolean or undefined";if(this.__drop_mode=o,0==this.__drop_mode)return this;var e=this;return this.handle_clicks(function(){var o=t.select(this).attr("data-col-head"),n=t.select(this).attr("data-row-head");null!=o?e.drop.call(e,"col",o):null!=n&&e.drop.call(e,"row",n),e.from_html(),e.draw()}),this},e.prototype.unhandle_clicks=function(){this.container().selectAll("th").on("click",null)},e.prototype.drop=function(t,o){var e="[data-"+t+"='"+o+"']";console.log("selector",e),this.container().selectAll(e).remove(),this.from_html(),this.draw()},e.prototype.download=function(t){var t=t||"data.csv",o=URL.createObjectURL(this.obj().to_csvblob()),e=document.createElement("a");e.setAttribute("href",o),e.setAttribute("download",t),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)},{data:o,ui:e}}(d3);
